<!doctype html><html lang=pt-br><head><title>Índice invertido (inverted index) · Júlio César Batista
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Júlio César Batista"><meta name=description content="A matriz de incidência termo-documento é uma das formas de representar um índice de termos por documento.
Mesmo usando o conceito de uma matriz esparsa, essa estrutura pode crescer muito para ser usada em memória.
Uma alternativa para esse caso é usar um índice invertido (inverted index).
Dados os seguintes documentos como exemplo:

Uma casa à venda em Blumenau
Vendo terreno em Gaspar
Alugo apartamento em Indaial

A matriz de incidência é:"><meta name=keywords content="blog,software,developer"><meta name=fediverse:creator content><meta name=twitter:card content="summary"><meta name=twitter:title content="Índice invertido (inverted index)"><meta name=twitter:description content="A matriz de incidência termo-documento é uma das formas de representar um índice de termos por documento. Mesmo usando o conceito de uma matriz esparsa, essa estrutura pode crescer muito para ser usada em memória. Uma alternativa para esse caso é usar um índice invertido (inverted index).
Dados os seguintes documentos como exemplo:
Uma casa à venda em Blumenau Vendo terreno em Gaspar Alugo apartamento em Indaial A matriz de incidência é:"><meta property="og:url" content="https://juliocesarbatista.com/posts/indice-invertido/"><meta property="og:site_name" content="Júlio César Batista"><meta property="og:title" content="Índice invertido (inverted index)"><meta property="og:description" content="A matriz de incidência termo-documento é uma das formas de representar um índice de termos por documento. Mesmo usando o conceito de uma matriz esparsa, essa estrutura pode crescer muito para ser usada em memória. Uma alternativa para esse caso é usar um índice invertido (inverted index).
Dados os seguintes documentos como exemplo:
Uma casa à venda em Blumenau Vendo terreno em Gaspar Alugo apartamento em Indaial A matriz de incidência é:"><meta property="og:locale" content="pt_br"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-28T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-28T00:00:00+00:00"><meta property="article:tag" content="Recuperação De Informação"><meta property="article:tag" content="Python"><meta property="article:tag" content="Inverted Index"><meta property="article:tag" content="Índice Invertido"><meta property="article:tag" content="Boolean Query"><meta property="article:tag" content="Nltk"><link rel=canonical href=https://juliocesarbatista.com/posts/indice-invertido/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.07092c1350ffd254998dc43a44ae96e617d14af4df4602626878df89189c5e1a.css integrity="sha256-BwksE1D/0lSZjcQ6RK6W5hfRSvTfRgJiaHjfiRicXho=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://juliocesarbatista.com/>Júlio César Batista
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/tags/publica%c3%a7%c3%a3o/>Publicações</a></li><li class=navigation-item><a class=navigation-link href=/tags/projeto/>Projetos</a></li><li class=navigation-item><a class=navigation-link href=/tags/notas/>Notas</a></li><li class=navigation-item><a class=navigation-link href=/tags/>Tags</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://juliocesarbatista.com/posts/indice-invertido/>Índice invertido (inverted index)</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-12-28T00:00:00Z>2019-12-28
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4 minutos de leitura</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/recupera%C3%A7%C3%A3o-de-informa%C3%A7%C3%A3o/>Recuperação De Informação</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/python/>Python</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/inverted-index/>Inverted Index</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/%C3%ADndice-invertido/>Índice Invertido</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/boolean-query/>Boolean Query</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/nltk/>Nltk</a>
</span><span class=separator>•</span>
<span class=tag><a href=/tags/estruturas-de-dados/>Estruturas De Dados</a></span></div></div></header><div class=post-content><p><a href=https://juliocesarbatista.com/post/matriz-incidencia-termo-documento/ class=external-link target=_blank rel=noopener>A matriz de incidência termo-documento</a> é uma das formas de representar um índice de termos por documento.
Mesmo usando o conceito de uma matriz esparsa, essa estrutura pode crescer muito para ser usada em memória.
Uma alternativa para esse caso é usar um índice invertido (<em>inverted index</em>).</p><p>Dados os seguintes documentos como exemplo:</p><ul><li>Uma casa à venda em Blumenau</li><li>Vendo terreno em Gaspar</li><li>Alugo apartamento em Indaial</li></ul><p>A matriz de incidência é:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># matriz de incidência termo-documento
</span></span><span style=display:flex><span>I = [
</span></span><span style=display:flex><span>    #1  2  3    # id do documento
</span></span><span style=display:flex><span>    [0, 0, 1],  # alugo
</span></span><span style=display:flex><span>    [0, 0, 1],  # apartamento
</span></span><span style=display:flex><span>    [1, 0, 0],  # blumenau
</span></span><span style=display:flex><span>    [1, 0, 0],  # casa
</span></span><span style=display:flex><span>    [0, 1, 0],  # gaspar
</span></span><span style=display:flex><span>    [0, 0, 1],  # indaial
</span></span><span style=display:flex><span>    [0, 1, 0],  # terreno
</span></span><span style=display:flex><span>    [1, 1, 0],  # venda
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>O índice invertido é, basicamente, um dicionário.
Nesse exemplo, ele será representado em memória, mas a ideia é que as listas de documentos (<em>posting lists</em>) devem ser persistidas em disco e apenas os termos (chaves do dicionário) devem ficar em memória.
O exemplo anterior como um índice invertido:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># índice invertido
</span></span><span style=display:flex><span>I = {
</span></span><span style=display:flex><span>    &#39;__alldocs__&#39;: [1, 2, 3],
</span></span><span style=display:flex><span>    &#39;alugo&#39;: [3],
</span></span><span style=display:flex><span>    &#39;apartamento&#39;: [3],
</span></span><span style=display:flex><span>    &#39;blumenau&#39;: [1],
</span></span><span style=display:flex><span>    &#39;casa&#39;: [1],
</span></span><span style=display:flex><span>    &#39;gaspar&#39;: [2],
</span></span><span style=display:flex><span>    &#39;indaial&#39;: [3],
</span></span><span style=display:flex><span>    &#39;terreno&#39;: [2],
</span></span><span style=display:flex><span>    &#39;venda&#39;: [1, 2],
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As chaves do dicionário são os termos, também chamado de vocabulário.
Os valores são listas com os <em>ids</em> dos documentos (<em>postings lists</em>).
O detalhe é que, as consultas <em>booleanas</em> agora ficam como operações em conjuntos e não mais como operações <em>bitwise</em>.
Também foi necessário adicionar um termo especial <code>__alldocs__</code> com todos os <em>ids</em>.
Esse termo é necessário para processar consultas com <code>NOT</code>.</p><p>Exemplos de consultas</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># venda AND blumenau
</span></span><span style=display:flex><span>venda = I[&#39;venda&#39;]
</span></span><span style=display:flex><span>blumenau = I[&#39;blumenau&#39;]
</span></span><span style=display:flex><span>set(venda) &amp; set(blumenau)  # intersecção de conjuntos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># gaspar OR indaial
</span></span><span style=display:flex><span>gaspar = I[&#39;gaspar&#39;]
</span></span><span style=display:flex><span>indaial = I[&#39;indaial&#39;]
</span></span><span style=display:flex><span>set(gaspar) | set(indaial)  # união de conjuntos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span># venda AND NOT gaspar
</span></span><span style=display:flex><span>venda = I[&#39;venda&#39;]
</span></span><span style=display:flex><span>gaspar = I[&#39;gaspar&#39;]
</span></span><span style=display:flex><span>not_gaspar = set(I[&#39;__alldocs__&#39;]) - set(I[&#39;gaspar&#39;])
</span></span><span style=display:flex><span>set(venda) &amp; not_gaspar
</span></span></code></pre></div><p>Para mais detalhes de como funcionam as operações com conjuntos veja <a href=https://juliocesarbatista.com/post/python-sets/ class=external-link target=_blank rel=noopener>esse post</a>.</p><p>Um exemplo completo de como construir o índice inverso com <a href=http://www.nltk.org/ class=external-link target=_blank rel=noopener>NLTK</a> e o <a href=https://en.wikipedia.org/wiki/Brown_Corpus class=external-link target=_blank rel=noopener>Brown Corpus</a>.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gdscript3 data-lang=gdscript3><span style=display:flex><span>import string
</span></span><span style=display:flex><span>from itertools import chain
</span></span><span style=display:flex><span>from collections import defaultdict
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import nltk
</span></span><span style=display:flex><span>from nltk.corpus import brown
</span></span><span style=display:flex><span>from nltk.corpus import stopwords
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># baixa o corpus</span>
</span></span><span style=display:flex><span>nltk.download(<span style=font-style:italic>&#39;brown&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># funções de pré-processamento</span>
</span></span><span style=display:flex><span>STOP_WORDS = set(stopwords.words(<span style=font-style:italic>&#39;english&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> filtrar_stop_words(doc):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> (p <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> doc <span style=font-weight:700>if</span> p <span style=font-weight:700>not</span> <span style=font-weight:700>in</span> STOP_WORDS)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> filtrar_pontuacao(doc):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> (p <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> doc <span style=font-weight:700>if</span> p <span style=font-weight:700>not</span> <span style=font-weight:700>in</span> string.punctuation)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>def</span> normalizar_palavras(doc):
</span></span><span style=display:flex><span>    <span style=font-weight:700>return</span> (p.lower() <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> doc)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># paragrafos no formato de lista de frases</span>
</span></span><span style=display:flex><span><span style=font-style:italic># sendo cada frase uma lista de palavras</span>
</span></span><span style=display:flex><span><span style=font-style:italic># o correto nesse caso é apenas uma lista de palavras por paragrafo</span>
</span></span><span style=display:flex><span>DOCUMENTOS = brown.paras()
</span></span><span style=display:flex><span>DOCUMENTOS = [list(chain.from_iterable(p)) <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> DOCUMENTOS]
</span></span><span style=display:flex><span><span style=font-style:italic># faz uma normalização de texto</span>
</span></span><span style=display:flex><span><span style=font-style:italic># deveria ser melhor, mas vai ficar no simples por enquanto</span>
</span></span><span style=display:flex><span>documentos = (normalizar_palavras(p) <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> DOCUMENTOS)
</span></span><span style=display:flex><span><span style=font-style:italic># remove pontuação</span>
</span></span><span style=display:flex><span>documentos = (filtrar_pontuacao(p) <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> documentos)
</span></span><span style=display:flex><span><span style=font-style:italic># remove stop words</span>
</span></span><span style=display:flex><span>documentos = (filtrar_stop_words(p) <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> documentos)
</span></span><span style=display:flex><span><span style=font-style:italic># transforma em uma lista</span>
</span></span><span style=display:flex><span>documentos = [list(p) <span style=font-weight:700>for</span> p <span style=font-weight:700>in</span> documentos]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># constrói o índice invertido</span>
</span></span><span style=display:flex><span>inverted_index = defaultdict(list)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-weight:700>for</span> (doc_id, doc) <span style=font-weight:700>in</span> enumerate(documentos):
</span></span><span style=display:flex><span>    <span style=font-style:italic># termo especial para queries com NOT</span>
</span></span><span style=display:flex><span>    inverted_index[<span style=font-style:italic>&#39;__alldocs__&#39;</span>].append(doc_id)
</span></span><span style=display:flex><span>    <span style=font-weight:700>for</span> termo <span style=font-weight:700>in</span> doc:
</span></span><span style=display:flex><span>        inverted_index[termo].append(doc_id)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=font-style:italic># testes</span>
</span></span><span style=display:flex><span>print(<span style=font-style:italic>&#39;voters AND jury&#39;</span>)
</span></span><span style=display:flex><span>voters = inverted_index[<span style=font-style:italic>&#39;voters&#39;</span>]
</span></span><span style=display:flex><span>jury = inverted_index[<span style=font-style:italic>&#39;jury&#39;</span>]
</span></span><span style=display:flex><span>doc_ids = set(voters) &amp; set(jury)
</span></span><span style=display:flex><span><span style=font-weight:700>for</span> doc_id <span style=font-weight:700>in</span> doc_ids:
</span></span><span style=display:flex><span>    print(<span style=font-style:italic>&#39;&gt; &#39;</span>, <span style=font-style:italic>&#39; &#39;</span>.join(DOCUMENTOS[doc_id]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=font-style:italic>&#39;voters OR city&#39;</span>)
</span></span><span style=display:flex><span>voters = inverted_index[<span style=font-style:italic>&#39;voters&#39;</span>]
</span></span><span style=display:flex><span>city = inverted_index[<span style=font-style:italic>&#39;city&#39;</span>]
</span></span><span style=display:flex><span>doc_ids = set(voters) | set(city)
</span></span><span style=display:flex><span><span style=font-weight:700>for</span> doc_id <span style=font-weight:700>in</span> doc_ids:
</span></span><span style=display:flex><span>    print(<span style=font-style:italic>&#39;&gt; &#39;</span>, <span style=font-style:italic>&#39; &#39;</span>.join(DOCUMENTOS[doc_id]))
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>print(<span style=font-style:italic>&#39;voters AND NOT city&#39;</span>)
</span></span><span style=display:flex><span>voters = inverted_index[<span style=font-style:italic>&#39;voters&#39;</span>]
</span></span><span style=display:flex><span>city = inverted_index[<span style=font-style:italic>&#39;city&#39;</span>]
</span></span><span style=display:flex><span>not_city = set(inverted_index[<span style=font-style:italic>&#39;__alldocs__&#39;</span>]) - set(city)
</span></span><span style=display:flex><span>doc_ids = set(voters) &amp; set(not_city)
</span></span><span style=display:flex><span><span style=font-weight:700>for</span> doc_id <span style=font-weight:700>in</span> doc_ids:
</span></span><span style=display:flex><span>    print(<span style=font-style:italic>&#39;&gt; &#39;</span>, <span style=font-style:italic>&#39; &#39;</span>.join(DOCUMENTOS[doc_id]))
</span></span></code></pre></div><p>Idealmente, o índice invertido deve manter apenas o vocabulário em memória.
Os <em>postings</em> (conjunto de todas as <em>postings lists</em>) deve ser armazenado no disco e lido conforme necessidade.
Também é importante notar que em alguns casos é possível armazenar o tamanho da <em>posting list</em>, mas nesse caso foi evitado porque não era necessário no momento e com <code>python</code> basta executar <code>len()</code> para obter o valor.</p><p>A principal vantagem do índice invertido sobre a matriz de incidência é o uso de memória.
Enquanto a matriz precisa ficar em memória, o índice pode ficar parcialmente no disco.
Outro detalhe é que o índice invertido guarda apenas os documentos com ocorrência dos termos.
Apesar que esse problema foi resolvido usando uma matriz esparsa, que guarda apenas os valores diferentes de <code>0</code>.
Finalmente, é possível estender os algoritmos de processamento de um índice invertido para otimizar a busca ou até mesmo adicionar mais meta dados (como a posição do termo no documento).</p><h2 id=referências>Referências
<a class=heading-link href=#refer%c3%aancias><i class="fa-solid fa-link" aria-hidden=true title="Link para o cabeçalho"></i>
<span class=sr-only>Link para o cabeçalho</span></a></h2><ul><li><a href=https://www.systems.ethz.ch/sites/default/files/file/ir2018spring/02%20Information%20Retrieval%20-%20Boolean%20Retrieval.pdf class=external-link target=_blank rel=noopener>2. Boolean Retrieval</a></li><li><a href=https://nlp.stanford.edu/IR-book/html/htmledition/a-first-take-at-building-an-inverted-index-1.html class=external-link target=_blank rel=noopener>A first take at building an inverted index</a></li></ul></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2016 -
2024
Júlio César Batista
·
Promovido por <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1BE56W9H8M"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-1BE56W9H8M")}</script></body></html>